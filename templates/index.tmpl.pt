<html metal:use-macro="context/@@base.tmpl/index/macros/base"
      xmlns:metal="http://xml.zope.org/namespaces/metal">

<!--! <%namespace name="helper" file="index_helper.tmpl"/> -->
<!--! <%namespace name="math" file="math_helper.tmpl"/> -->
<!--! <%namespace name="comments" file="comments_helper.tmpl"/> -->
<!--! <%namespace name="pagination" file="pagination_helper.tmpl"/> -->
<!--! <%namespace name="feeds_translations" file="feeds_translations_helper.tmpl" import="*"/> -->
<!--! <%inherit file="base.tmpl"/> -->

<metal:block metal:fill-slot="extra_head">
    <link
        tal:define="posts options/posts;
                    permalink options/permalink;
                    index_file options/index_file|string:nothing"
        tal:condition="python: posts and (permalink == '/' or permalink == '/' + index_file)"
        rel="prefetch"
        href="${python:options['posts'][0].permalink()}"
        type="text/html" />
    <metal:block metal:use-macro="macro:math_styles_ifposts" />
</metal:block>


<!-- This is registered for IMainIndexPageKind -->
<metal:block define-macro="front_index_header_IMainIndexPageKind">
    <h1 tal:replace="structure:options/front_index_header" />
</metal:block>

<metal:block metal:fill-slot="content">
    <metal:block metal:fill-slot="content_header">
    <!--! ${feeds_translations.translation_link(kind)} -->
    </metal:block>

    <h1 metal:use-macro="macro:front_index_header" />

    <metal:block use-macro="macro:page_navigation"
                 tal:condition="options/page_links|nothing" />
    <div class="postindex"
         tal:define="index_teasers options/index_teasers;
                     _link nocall:options/_link">
      <tal:block tal:repeat="post options/posts">
        <article
                 class="h-entry post-${post/meta:type}
                        ${python:'post-preview' if index_teasers else ''}">
                <a href="${post/permalink}" class="u-url">
                  <h1 class="p-name entry-title
                             post-title">${post/title}</h1>
                </a>
                <div class="metadata post-meta">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        <a tal:condition="options/author_pages_generated"
                           href="${python:_link('author', post.author())}">
                            ${post/author}
                        </a>
                        <a tal:condition="not:options/author_pages_generated"
                           tal:replace="post/author" />
                    </span></p>
                    <p class="dateline">
                        <a href="${post/permalink}" rel="bookmark">
                            <time class="published dt-published"
                                  datetime="${python:post.formatted_date('webiso')}"
                                  title="${python:post.formatted_date(options['date_format'])}">
                                ${python:post.formatted_date(options['date_format'])}
                            </time>
                    </a></p>
                    <p class="commentline"
                       tal:condition="python: not post.meta('nocomments') and options['site_has_comments']">
                        ${comments.comment_link(post.permalink(), post._base_path)}
                    </p>
                </div>

            <div tal:condition="index_teasers"
                 class="p-summary entry-summary"
                 tal:content="structure:python:post.text(teaser_only=True)">
            </div>

            <div tal:condition="not:index_teasers"
                 class="e-content entry-content"
                 tal:content="structure:python:post.text(teaser_only=False)">
            </div>


        </article>
        <hr />
      </tal:block>
    </div>

    <metal:block metal:use-macro="macro:html_pager" />
    <metal:block metal:use-macro="macro:math_scripts_ifposts" />
    <metal:block metal:use-macro="macro:comment_link_script"
                 tal:condition="options/site_has_comments" />

</metal:block>

</html>
